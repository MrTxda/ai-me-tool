<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ AI Cho Kỹ Sư M&E & HVAC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Tech -->
    <!-- Application Structure Plan: A two-page horizontal-scroll application. The two sections, "Risk Analysis" and "Consulting," are now separate 'pages' within a single, horizontally scrolling container. This structure was chosen to provide a clean, focused view for each tool, eliminating vertical scrolling and using a horizontal 'swipe' or click navigation for a more modern, app-like user experience. The content within each page is centered to maintain visual balance. -->
    <!-- Visualization & Content Choices: 
        1. AI Risk Analysis Tool: User input (text) -> AI response (text). Goal is problem-solving.
        2. AI Consulting Tool: User input (text) -> AI response (text). Goal is providing expert advice.
        Both tools are implemented using standard HTML forms, buttons, and text areas, with JavaScript to handle asynchronous API calls. The main innovation is the use of Tailwind's `flex`, `w-screen`, `h-screen`, and `snap-x` utilities with custom JS to manage the horizontal navigation between these two distinct tool pages.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            overscroll-behavior-x: contain;
        }
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        .snap-container {
            width: 100vw;
            display: flex;
            flex-direction: row;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
        }
        .snap-item {
            width: 100vw;
            flex-shrink: 0;
            scroll-snap-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        #ai-response-container-risk, #ai-response-container-advice {
            min-height: 12rem; /* h-48 equivalent */
            overflow-y: auto;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div id="page-container" class="snap-container">
        
        <!-- Page 1: Risk Analysis Section -->
        <div id="page-1" class="snap-item min-h-screen">
            <div class="w-full max-w-3xl">
                <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Phân Tích Rủi Ro & Giải Pháp AI ✨</h1>
                    <p class="text-lg md:text-xl text-slate-500 max-w-2xl mx-auto">
                        Mô tả tình huống hoặc vấn đề của bạn để nhận được phân tích và đề xuất giải pháp chuyên nghiệp.
                    </p>
                </header>
                <div class="p-6 bg-white rounded-xl shadow-sm">
                    <label for="risk-input" class="block text-lg font-semibold mb-2 text-slate-700">Mô tả tình huống:</label>
                    <textarea id="risk-input" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm text-slate-700" placeholder="Ví dụ: Cần tư vấn giải pháp HVAC tiết kiệm năng lượng cho một tòa nhà văn phòng 5 tầng."></textarea>
                    <button id="analyze-btn" class="mt-4 w-full md:w-auto px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors duration-200">Gửi yêu cầu</button>
                    
                    <div id="aiResponseContainerRisk" class="mt-6 hidden">
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-b pb-2">Kết quả Phân tích:</h3>
                        <div id="loaderRisk" class="flex justify-center items-center py-4">
                            <svg class="animate-spin h-8 w-8 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <div id="aiResponseRisk" class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-slate-700"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 2: Consulting Section -->
        <div id="page-2" class="snap-item min-h-screen">
            <div class="w-full max-w-3xl">
                 <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Tư Vấn & Lời Khuyên Chuyên Gia ✨</h1>
                    <p class="text-lg md:text-xl text-slate-500 max-w-2xl mx-auto">
                        Nhập một câu hỏi hoặc tình huống để nhận lời khuyên từ AI.
                    </p>
                </header>
                <div class="p-6 bg-white rounded-xl shadow-sm">
                    <label for="advice-input" class="block text-lg font-semibold mb-2 text-slate-700">Câu hỏi hoặc tình huống của bạn:</label>
                    <textarea id="advice-input" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm text-slate-700" placeholder="Ví dụ: Làm thế nào để tối ưu hóa hiệu suất năng lượng cho hệ thống điều hòa?"></textarea>
                    <button id="advice-btn" class="mt-4 w-full md:w-auto px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors duration-200">Nhận tư vấn</button>
                    
                    <div id="aiResponseContainerAdvice" class="mt-6 hidden">
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-b pb-2">Kết quả Tư vấn:</h3>
                        <div id="loaderAdvice" class="flex justify-center items-center py-4">
                             <svg class="animate-spin h-8 w-8 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <div id="aiResponseAdvice" class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-slate-700"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="fixed bottom-0 left-0 right-0 p-4 flex justify-center space-x-4 bg-white bg-opacity-80 backdrop-blur-sm z-10">
        <button id="nav-btn-1" class="px-4 py-2 rounded-full bg-cyan-600 text-white font-bold text-sm">Giải pháp</button>
        <button id="nav-btn-2" class="px-4 py-2 rounded-full bg-slate-200 text-slate-700 font-bold text-sm">Tư vấn</button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // UI elements
            const pageContainer = document.getElementById('page-container');
            const navBtn1 = document.getElementById('nav-btn-1');
            const navBtn2 = document.getElementById('nav-btn-2');
            const page1 = document.getElementById('page-1');
            const page2 = document.getElementById('page-2');

            // API Functionality - Risk Analysis
            const analyzeBtn = document.getElementById('analyze-btn');
            const riskInput = document.getElementById('risk-input');
            const aiResponseContainerRisk = document.getElementById('aiResponseContainerRisk');
            const loaderRisk = document.getElementById('loaderRisk');
            const aiResponseRisk = document.getElementById('aiResponseRisk');
            const suggestionContainerRisk = document.createElement('div');
            suggestionContainerRisk.className = "mt-4 flex flex-wrap gap-2 hidden";
            const suggestionTitleRisk = document.createElement('p');
            suggestionTitleRisk.className = "text-sm text-slate-500 w-full";
            suggestionTitleRisk.innerText = "Gợi ý câu hỏi tiếp theo:";
            suggestionContainerRisk.appendChild(suggestionTitleRisk);

            // API Functionality - Consulting
            const adviceBtn = document.getElementById('advice-btn');
            const adviceInput = document.getElementById('advice-input');
            const aiResponseContainerAdvice = document.getElementById('aiResponseContainerAdvice');
            const loaderAdvice = document.getElementById('loaderAdvice');
            const aiResponseAdvice = document.getElementById('aiResponseAdvice');
            const suggestionContainerAdvice = document.createElement('div');
            suggestionContainerAdvice.className = "mt-4 flex flex-wrap gap-2 hidden";
            const suggestionTitleAdvice = document.createElement('p');
            suggestionTitleAdvice.className = "text-sm text-slate-500 w-full";
            suggestionTitleAdvice.innerText = "Gợi ý câu hỏi tiếp theo:";
            suggestionContainerAdvice.appendChild(suggestionTitleAdvice);
            
            const makeApiCall = async (prompt, responseContainer, loaderElement, responseElement, suggestionsContainer, retryCount = 0) => {
                const maxRetries = 3;
                responseContainer.classList.remove('hidden');
                loaderElement.classList.remove('hidden');
                responseElement.innerHTML = '';
                suggestionsContainer.classList.add('hidden');
                
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { 
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "response": { "type": "STRING" },
                                    "suggestions": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    }
                                }
                            }
                        }
                    };
                    const apiKey = "AIzaSyD_ca1ZkBV-V95lKm2B-UsgeUxK1xlnZ5M"
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const json = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(json);
                        
                        const htmlContent = marked.parse(parsedJson.response);
                        responseElement.innerHTML = htmlContent;

                        if (parsedJson.suggestions && parsedJson.suggestions.length > 0) {
                            suggestionsContainer.innerHTML = '';
                            suggestionsContainer.appendChild(suggestionTitleRisk.cloneNode(true));
                            parsedJson.suggestions.forEach(suggestion => {
                                const btn = document.createElement('button');
                                btn.className = "px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-medium hover:bg-slate-200 transition-colors duration-200";
                                btn.innerText = suggestion;
                                btn.onclick = () => {
                                    if (responseElement === aiResponseRisk) {
                                        riskInput.value = suggestion;
                                        analyzeBtn.click();
                                    } else {
                                        adviceInput.value = suggestion;
                                        adviceBtn.click();
                                    }
                                };
                                suggestionsContainer.appendChild(btn);
                            });
                            suggestionsContainer.classList.remove('hidden');
                        }
                    } else {
                        throw new Error('Invalid response structure from API.');
                    }
                } catch (error) {
                    if (retryCount < maxRetries) {
                        const delay = Math.pow(2, retryCount) * 1000;
                        setTimeout(() => makeApiCall(prompt, responseContainer, loaderElement, responseElement, suggestionsContainer, retryCount + 1), delay);
                    } else {
                        responseElement.innerText = `Có lỗi xảy ra: ${error.message}. Vui lòng thử lại sau.`;
                        console.error('Error fetching AI response:', error);
                    }
                } finally {
                    loaderElement.classList.add('hidden');
                }
            };

            // Event Listeners for new features
            analyzeBtn.addEventListener('click', async () => {
                const userRisk = riskInput.value.trim();
                if (!userRisk) {
                    alert('Vui lòng nhập một rủi ro để phân tích.');
                    return;
                }
                aiResponseRisk.innerHTML = '';
                aiResponseContainerRisk.classList.add('hidden');

                const prompt = `Hãy đóng vai trò là một kỹ sư cơ điện (M&E) và HVAC có kinh nghiệm. Phân tích một cách chi tiết tình huống sau đây và đề xuất các giải pháp khả thi. Sử dụng Markdown để định dạng câu trả lời với các tiêu đề, danh sách, và in đậm. Sau đó, hãy đưa ra 3 gợi ý câu hỏi tiếp theo có liên quan đến tình huống này. Trả lời bằng JSON với hai trường 'response' cho câu trả lời chi tiết và 'suggestions' là một mảng chuỗi cho các gợi ý. Tình huống: ${userRisk}`;
                makeApiCall(prompt, aiResponseContainerRisk, loaderRisk, aiResponseRisk, suggestionContainerRisk);
                if (aiResponseContainerRisk.contains(suggestionContainerRisk)) {
                    aiResponseContainerRisk.removeChild(suggestionContainerRisk);
                }
                 aiResponseContainerRisk.appendChild(suggestionContainerRisk);
            });

             adviceBtn.addEventListener('click', async () => {
                const userAdvice = adviceInput.value.trim();
                if (!userAdvice) {
                    alert('Vui lòng nhập câu hỏi hoặc tình huống của bạn.');
                    return;
                }
                aiResponseAdvice.innerHTML = '';
                aiResponseContainerAdvice.classList.add('hidden');
                
                const prompt = `Hãy đóng vai trò là một kỹ sư M&E/HVAC có kinh nghiệm. Dựa trên câu hỏi/tình huống sau, đưa ra lời khuyên chuyên nghiệp và hữu ích. Sử dụng Markdown để định dạng câu trả lời với các tiêu đề, danh sách, và in đậm. Sau đó, hãy đưa ra 3 gợi ý câu hỏi tiếp theo có liên quan đến tình huống này. Trả lời bằng JSON với hai trường 'response' cho câu trả lời chi tiết và 'suggestions' là một mảng chuỗi cho các gợi ý. Tình huống: ${userAdvice}`;
                makeApiCall(prompt, aiResponseContainerAdvice, loaderAdvice, aiResponseAdvice, suggestionContainerAdvice);
                if (aiResponseContainerAdvice.contains(suggestionContainerAdvice)) {
                    aiResponseContainerAdvice.removeChild(suggestionContainerAdvice);
                }
                 aiResponseContainerAdvice.appendChild(suggestionContainerAdvice);
            });
            
            // UI Navigation
            const updateNavButtons = (pageIndex) => {
                navBtn1.classList.remove('bg-cyan-600', 'text-white');
                navBtn1.classList.add('bg-slate-200', 'text-slate-700');
                navBtn2.classList.remove('bg-cyan-600', 'text-white');
                navBtn2.classList.add('bg-slate-200', 'text-slate-700');
                if (pageIndex === 0) {
                    navBtn1.classList.add('bg-cyan-600', 'text-white');
                    navBtn1.classList.remove('bg-slate-200', 'text-slate-700');
                } else {
                    navBtn2.classList.add('bg-cyan-600', 'text-white');
                    navBtn2.classList.remove('bg-slate-200', 'text-slate-700');
                }
            };
            
            navBtn1.addEventListener('click', () => {
                pageContainer.scrollTo({
                    left: 0,
                    behavior: 'smooth'
                });
                updateNavButtons(0);
            });

            navBtn2.addEventListener('click', () => {
                pageContainer.scrollTo({
                    left: page2.offsetLeft,
                    behavior: 'smooth'
                });
                updateNavButtons(1);
            });

            pageContainer.addEventListener('scroll', () => {
                const scrollLeft = pageContainer.scrollLeft;
                const pageOneOffset = page1.offsetLeft;
                if (scrollLeft < pageOneOffset + page1.offsetWidth / 2) {
                    updateNavButtons(0);
                } else {
                    updateNavButtons(1);
                }
            });

            updateNavButtons(0); // Set initial active button
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
