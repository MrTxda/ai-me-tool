<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ AI Cho Kỹ Sư M&E & HVAC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Tech -->
    <!-- Application Structure Plan: A two-page horizontal-scroll application. The two sections, "Risk Analysis" and "Consulting," are now separate 'pages' within a single, horizontally scrolling container. This structure was chosen to provide a clean, focused view for each tool, eliminating vertical scrolling and using a horizontal 'swipe' or click navigation for a more modern, app-like user experience. The content within each page is centered to maintain visual balance. -->
    <!-- Visualization & Content Choices: 
        1. AI Risk Analysis Tool: User input (text) -> AI response (text). Goal is problem-solving.
        2. AI Consulting Tool: User input (text) -> AI response (text). Goal is providing expert advice.
        Both tools are implemented using standard HTML forms, buttons, and text areas, with JavaScript to handle asynchronous API calls. The main innovation is the use of Tailwind's `flex`, `w-screen`, `h-screen`, and `snap-x` utilities with custom JS to manage the horizontal navigation between these two distinct tool pages.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            overscroll-behavior-x: contain;
        }
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        .snap-container {
            width: 100vw;
            display: flex;
            flex-direction: row;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
        }
        .snap-item {
            width: 100vw;
            flex-shrink: 0;
            scroll-snap-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        #ai-response-container-risk, #ai-response-container-advice, #aiResponseContainerDesign {
            min-height: 12rem;
            overflow-y: auto;
        }
        #aiResponseRisk, #aiResponseAdvice, #aiResponseDesign {
            display: grid;
            gap: 1rem;
        }
        #aiResponseRisk > *, #aiResponseAdvice > *, #aiResponseDesign > * {
            margin-bottom: 0.5rem;
        }
        #aiResponseRisk h1, #aiResponseAdvice h1, #aiResponseDesign h1 {
            font-size: 1.5rem;
            font-weight: bold;
        }
        #aiResponseRisk h2, #aiResponseAdvice h2, #aiResponseDesign h2 {
            font-size: 1.25rem;
            font-weight: bold;
        }
        #aiResponseRisk p, #aiResponseAdvice p, #aiResponseDesign p {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="antialiased">

    <div id="page-container" class="snap-container">
        
        <!-- Page 1: Design Consulting -->
        <div id="page-1" class="snap-item min-h-screen">
            <div class="w-full max-w-3xl">
                <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Tư Vấn Thiết Kế Hệ Thống ✨</h1>
                    <p class="text-lg md:text-xl text-slate-500 max-w-2xl mx-auto">
                        Nhập yêu cầu thiết kế để nhận bản tư vấn chi tiết, áp dụng các tiêu chuẩn TCVN và tiêu chuẩn quốc tế.
                    </p>
                </header>
                <div class="p-6 bg-white rounded-xl shadow-sm">
                    <div class="mb-4">
                        <label class="block text-lg font-semibold mb-2 text-slate-700">Nhập mô tả hoặc tải ảnh lên:</label>
                        <div class="flex items-center space-x-2">
                            <input type="file" id="design-file-input" accept="image/*" class="hidden">
                            <label for="design-file-input" class="cursor-pointer px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Tải ảnh lên</label>
                            <button id="design-paste-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Dán ảnh</button>
                        </div>
                    </div>
                    <textarea id="design-input" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm text-slate-700" placeholder="Ví dụ: Thiết kế hệ thống HVAC cho một khách sạn 4 sao với 100 phòng, tại Hà Nội."></textarea>
                    <button id="design-btn" class="mt-4 w-full md:w-auto px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors duration-200">Gửi yêu cầu</button>
                    
                    <div id="aiResponseContainerDesign" class="mt-6 hidden">
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-b pb-2">Kết quả Tư vấn Thiết kế:</h3>
                        <div id="loaderDesign" class="flex justify-center items-center py-4">
                            <svg class="animate-spin h-8 w-8 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <div id="aiResponseDesign" class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-slate-700"></div>
                        <div id="share-design-btn-container" class="mt-4 hidden">
                            <button id="share-design-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Chia sẻ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: Risk Analysis Section -->
        <div id="page-2" class="snap-item min-h-screen">
            <div class="w-full max-w-3xl">
                <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Phân Tích Rủi Ro & Giải Pháp AI ✨</h1>
                    <p class="text-lg md:text-xl text-slate-500 max-w-2xl mx-auto">
                        Mô tả tình huống hoặc vấn đề của bạn để nhận được phân tích và đề xuất giải pháp chuyên nghiệp.
                    </p>
                </header>
                <div class="p-6 bg-white rounded-xl shadow-sm">
                    <div class="mb-4">
                        <label class="block text-lg font-semibold mb-2 text-slate-700">Nhập mô tả hoặc tải ảnh lên:</label>
                        <div class="flex items-center space-x-2">
                             <input type="file" id="risk-file-input" accept="image/*" class="hidden">
                             <label for="risk-file-input" class="cursor-pointer px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Tải ảnh lên</label>
                             <button id="risk-paste-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Dán ảnh</button>
                        </div>
                    </div>
                    <textarea id="risk-input" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm text-slate-700" placeholder="Hoặc nhập mô tả ở đây. Ví dụ: Cần tư vấn giải pháp HVAC tiết kiệm năng lượng cho một tòa nhà văn phòng 5 tầng."></textarea>
                    <button id="analyze-btn" class="mt-4 w-full md:w-auto px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors duration-200">Gửi yêu cầu</button>
                    
                    <div id="aiResponseContainerRisk" class="mt-6 hidden">
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-b pb-2">Kết quả Phân tích:</h3>
                        <div id="loaderRisk" class="flex justify-center items-center py-4">
                            <svg class="animate-spin h-8 w-8 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <div id="aiResponseRisk" class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-slate-700"></div>
                        <div id="share-risk-btn-container" class="mt-4 hidden">
                            <button id="share-risk-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Chia sẻ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 3: Consulting Section -->
        <div id="page-3" class="snap-item min-h-screen">
            <div class="w-full max-w-3xl">
                 <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Tư Vấn & Lời Khuyên Chuyên Gia ✨</h1>
                    <p class="text-lg md:text-xl text-slate-500 max-w-2xl mx-auto">
                        Nhập một câu hỏi hoặc tình huống để nhận lời khuyên từ AI.
                    </p>
                </header>
                <div class="p-6 bg-white rounded-xl shadow-sm">
                     <div class="mb-4">
                        <label class="block text-lg font-semibold mb-2 text-slate-700">Nhập mô tả hoặc tải ảnh lên:</label>
                        <div class="flex items-center space-x-2">
                             <input type="file" id="advice-file-input" accept="image/*" class="hidden">
                             <label for="advice-file-input" class="cursor-pointer px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Tải ảnh lên</label>
                             <button id="advice-paste-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Dán ảnh</button>
                        </div>
                    </div>
                    <textarea id="advice-input" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm text-slate-700" placeholder="Hoặc nhập mô tả ở đây. Ví dụ: Làm thế nào để tối ưu hóa hiệu suất năng lượng cho hệ thống điều hòa?"></textarea>
                    <button id="advice-btn" class="mt-4 w-full md:w-auto px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors duration-200">Nhận tư vấn</button>
                    
                    <div id="aiResponseContainerAdvice" class="mt-6 hidden">
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-b pb-2">Kết quả Tư vấn:</h3>
                        <div id="loaderAdvice" class="flex justify-center items-center py-4">
                             <svg class="animate-spin h-8 w-8 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <div id="aiResponseAdvice" class="p-4 bg-slate-50 rounded-lg border border-slate-200 text-slate-700"></div>
                        <div id="share-advice-btn-container" class="mt-4 hidden">
                            <button id="share-advice-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors duration-200">Chia sẻ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="fixed bottom-0 left-0 right-0 p-4 flex justify-center space-x-4 bg-white bg-opacity-80 backdrop-blur-sm z-10">
        <button id="nav-btn-1" class="px-4 py-2 rounded-full bg-cyan-600 text-white font-bold text-sm">Thiết kế</button>
        <button id="nav-btn-2" class="px-4 py-2 rounded-full bg-slate-200 text-slate-700 font-bold text-sm">Giải pháp</button>
        <button id="nav-btn-3" class="px-4 py-2 rounded-full bg-slate-200 text-slate-700 font-bold text-sm">Tư vấn</button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // UI elements
            const pageContainer = document.getElementById('page-container');
            const navBtn1 = document.getElementById('nav-btn-1');
            const navBtn2 = document.getElementById('nav-btn-2');
            const navBtn3 = document.getElementById('nav-btn-3');
            const page1 = document.getElementById('page-1');
            const page2 = document.getElementById('page-2');
            const page3 = document.getElementById('page-3');
            
            // API Functionality - Design
            const designBtn = document.getElementById('design-btn');
            const designInput = document.getElementById('design-input');
            const aiResponseContainerDesign = document.getElementById('aiResponseContainerDesign');
            const loaderDesign = document.getElementById('loaderDesign');
            const aiResponseDesign = document.getElementById('aiResponseDesign');
            const shareDesignBtnContainer = document.getElementById('share-design-btn-container');
            const shareDesignBtn = document.getElementById('share-design-btn');
            const designFile = document.getElementById('design-file-input');
            const designPaste = document.getElementById('design-paste-btn');
            const designImagePreview = document.createElement('img');
            designImagePreview.className = "mt-4 max-w-full h-auto hidden";
            designInput.parentNode.insertBefore(designImagePreview, designInput);
            const designBase64Data = { data: null, mimeType: null };
            
            const suggestionContainerDesign = document.createElement('div');
            suggestionContainerDesign.className = "mt-4 flex flex-wrap gap-2 hidden";
            const suggestionTitleDesign = document.createElement('p');
            suggestionTitleDesign.className = "text-sm text-slate-500 w-full";
            suggestionTitleDesign.innerText = "Gợi ý câu hỏi tiếp theo:";
            suggestionContainerDesign.appendChild(suggestionTitleDesign);
            
            // API Functionality - Risk Analysis
            const analyzeBtn = document.getElementById('analyze-btn');
            const riskInput = document.getElementById('risk-input');
            const aiResponseContainerRisk = document.getElementById('aiResponseContainerRisk');
            const loaderRisk = document.getElementById('loaderRisk');
            const aiResponseRisk = document.getElementById('aiResponseRisk');
            const shareRiskBtnContainer = document.getElementById('share-risk-btn-container');
            const shareRiskBtn = document.getElementById('share-risk-btn');
            const riskFile = document.getElementById('risk-file-input');
            const riskPaste = document.getElementById('risk-paste-btn');
            const riskImagePreview = document.createElement('img');
            riskImagePreview.className = "mt-4 max-w-full h-auto hidden";
            riskInput.parentNode.insertBefore(riskImagePreview, riskInput);
            const riskBase64Data = { data: null, mimeType: null };
            
            const suggestionContainerRisk = document.createElement('div');
            suggestionContainerRisk.className = "mt-4 flex flex-wrap gap-2 hidden";
            const suggestionTitleRisk = document.createElement('p');
            suggestionTitleRisk.className = "text-sm text-slate-500 w-full";
            suggestionTitleRisk.innerText = "Gợi ý câu hỏi tiếp theo:";
            suggestionContainerRisk.appendChild(suggestionTitleRisk);

            // API Functionality - Consulting
            const adviceBtn = document.getElementById('advice-btn');
            const adviceInput = document.getElementById('advice-input');
            const aiResponseContainerAdvice = document.getElementById('aiResponseContainerAdvice');
            const loaderAdvice = document.getElementById('loaderAdvice');
            const aiResponseAdvice = document.getElementById('aiResponseAdvice');
            const shareAdviceBtnContainer = document.getElementById('share-advice-btn-container');
            const shareAdviceBtn = document.getElementById('share-advice-btn');
            const adviceFile = document.getElementById('advice-file-input');
            const advicePaste = document.getElementById('advice-paste-btn');
            const adviceImagePreview = document.createElement('img');
            adviceImagePreview.className = "mt-4 max-w-full h-auto hidden";
            adviceInput.parentNode.insertBefore(adviceImagePreview, adviceInput);
            const adviceBase64Data = { data: null, mimeType: null };
            
            const suggestionContainerAdvice = document.createElement('div');
            suggestionContainerAdvice.className = "mt-4 flex flex-wrap gap-2 hidden";
            const suggestionTitleAdvice = document.createElement('p');
            suggestionTitleAdvice.className = "text-sm text-slate-500 w-full";
            suggestionTitleAdvice.innerText = "Gợi ý câu hỏi tiếp theo:";
            suggestionContainerAdvice.appendChild(suggestionTitleAdvice);
            
            const makeApiCall = async (prompt, responseContainer, loaderElement, responseElement, suggestionsContainer, userInput, shareBtnContainer, base64Data, retryCount = 0) => {
                const maxRetries = 3;
                responseContainer.classList.remove('hidden');
                loaderElement.classList.remove('hidden');
                responseElement.innerHTML = '';
                if(suggestionsContainer) suggestionsContainer.classList.add('hidden');
                if(shareBtnContainer) shareBtnContainer.classList.add('hidden');
                
                try {
                    let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    if (base64Data.data) {
                        chatHistory[0].parts.push({ inlineData: { mimeType: base64Data.mimeType, data: base64Data.data } });
                    }
                    const payload = { 
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "response": { "type": "STRING" },
                                    "suggestions": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    }
                                }
                            }
                        }
                    };
                    const apiKey = "AIzaSyD_ca1ZkBV-V95lKm2B-UsgeUxK1xlnZ5M"
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const json = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(json);
                        
                        const htmlContent = marked.parse(parsedJson.response);
                        responseElement.innerHTML = htmlContent;
                        if(shareBtnContainer) shareBtnContainer.classList.remove('hidden');

                        if (parsedJson.suggestions && parsedJson.suggestions.length > 0 && suggestionsContainer) {
                            suggestionsContainer.innerHTML = '';
                            const clonedTitle = suggestionTitleRisk.cloneNode(true);
                            clonedTitle.innerText = "Gợi ý câu hỏi tiếp theo:";
                            suggestionsContainer.appendChild(clonedTitle);
                            parsedJson.suggestions.forEach(suggestion => {
                                const btn = document.createElement('button');
                                btn.className = "px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-medium hover:bg-slate-200 transition-colors duration-200";
                                btn.innerText = suggestion;
                                btn.onclick = () => {
                                    if (responseElement === aiResponseRisk) {
                                        riskInput.value = suggestion;
                                        analyzeBtn.click();
                                    } else if (responseElement === aiResponseAdvice) {
                                        adviceInput.value = suggestion;
                                        adviceBtn.click();
                                    } else if (responseElement === aiResponseDesign) {
                                         designInput.value = suggestion;
                                         designBtn.click();
                                    }
                                };
                                suggestionsContainer.appendChild(btn);
                            });
                            suggestionsContainer.classList.remove('hidden');
                        }
                    } else {
                        throw new Error('Invalid response structure from API.');
                    }
                } catch (error) {
                    if (retryCount < maxRetries) {
                        const delay = Math.pow(2, retryCount) * 1000;
                        setTimeout(() => makeApiCall(prompt, responseContainer, loaderElement, responseElement, suggestionsContainer, userInput, shareBtnContainer, base64Data, retryCount + 1), delay);
                    } else {
                        responseElement.innerText = `Có lỗi xảy ra: ${error.message}. Vui lòng thử lại sau.`;
                        console.error('Error fetching AI response:', error);
                    }
                } finally {
                    loaderElement.classList.add('hidden');
                }
            };
            
            // Share button functionality
            const copyToClipboard = (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Nội dung đã được sao chép vào clipboard!');
            };

            shareDesignBtn.addEventListener('click', () => {
                copyToClipboard(aiResponseDesign.innerText);
            });

            shareRiskBtn.addEventListener('click', () => {
                copyToClipboard(aiResponseRisk.innerText);
            });
            
            shareAdviceBtn.addEventListener('click', () => {
                copyToClipboard(aiResponseAdvice.innerText);
            });

            // Image handling function
            const handleImageInput = (fileInput, imagePreview, base64Data) => {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        base64Data.data = e.target.result.split(',')[1];
                        base64Data.mimeType = file.type;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleImagePaste = (e, imagePreview, base64Data, inputElement) => {
                const items = e.clipboardData.items;
                for (const item of items) {
                    if (item.type.startsWith('image/')) {
                        const file = item.getAsFile();
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.src = e.target.result;
                            imagePreview.classList.remove('hidden');
                            base64Data.data = e.target.result.split(',')[1];
                            base64Data.mimeType = file.type;
                        };
                        reader.readAsDataURL(file);
                        e.preventDefault();
                        return;
                    }
                }
                // If no image, let the text paste
                const text = e.clipboardData.getData('text/plain');
                inputElement.value += text;
                e.preventDefault();
            };

            // Event Listeners for image inputs
            designInput.addEventListener('paste', (e) => handleImagePaste(e, designImagePreview, designBase64Data, designInput));
            designFile.addEventListener('change', () => handleImageInput(designFile, designImagePreview, designBase64Data));
            
            riskInput.addEventListener('paste', (e) => handleImagePaste(e, riskImagePreview, riskBase64Data, riskInput));
            riskFile.addEventListener('change', () => handleImageInput(riskFile, riskImagePreview, riskBase64Data));
            
            adviceInput.addEventListener('paste', (e) => handleImagePaste(e, adviceImagePreview, adviceBase64Data, adviceInput));
            adviceFile.addEventListener('change', () => handleImageInput(adviceFile, adviceImagePreview, adviceBase64Data));

            // API Event Listeners
            designBtn.addEventListener('click', async () => {
                const userDesign = designInput.value.trim();
                if (!userDesign && !designBase64Data.data) {
                    alert('Vui lòng nhập yêu cầu thiết kế hoặc tải lên một hình ảnh.');
                    return;
                }
                aiResponseDesign.innerHTML = '';
                aiResponseContainerDesign.classList.add('hidden');

                const prompt = `Hãy đóng vai trò là một kỹ sư cơ điện (M&E) và HVAC có kinh nghiệm. Dựa trên yêu cầu thiết kế sau, đưa ra bản tư vấn chi tiết về các giải pháp kỹ thuật, tiêu chuẩn áp dụng (bao gồm TCVN và các tiêu chuẩn quốc tế), và các yếu tố cần lưu ý. Sử dụng Markdown để định dạng câu trả lời với các tiêu đề, danh sách, và in đậm. Sau đó, hãy đưa ra 3 gợi ý câu hỏi tiếp theo có liên quan đến yêu cầu này. Trả lời bằng JSON với hai trường 'response' cho câu trả lời chi tiết và 'suggestions' là một mảng chuỗi cho các gợi ý. Yêu cầu: ${userDesign}`;
                makeApiCall(prompt, aiResponseContainerDesign, loaderDesign, aiResponseDesign, suggestionContainerDesign, userDesign, shareDesignBtnContainer, designBase64Data);
                if (aiResponseContainerDesign.contains(suggestionContainerDesign)) {
                    aiResponseContainerDesign.removeChild(suggestionContainerDesign);
                }
                aiResponseContainerDesign.appendChild(suggestionContainerDesign);
            });

            analyzeBtn.addEventListener('click', async () => {
                const userRisk = riskInput.value.trim();
                if (!userRisk && !riskBase64Data.data) {
                    alert('Vui lòng nhập một rủi ro để phân tích hoặc tải lên một hình ảnh.');
                    return;
                }
                aiResponseRisk.innerHTML = '';
                aiResponseContainerRisk.classList.add('hidden');

                const prompt = `Hãy đóng vai trò là một kỹ sư cơ điện (M&E) và HVAC có kinh nghiệm. Phân tích một cách chi tiết tình huống sau đây và đề xuất các giải pháp khả thi. Sử dụng Markdown để định dạng câu trả lời với các tiêu đề, danh sách, và in đậm. Sau đó, hãy đưa ra 3 gợi ý câu hỏi tiếp theo có liên quan đến tình huống này. Trả lời bằng JSON với hai trường 'response' cho câu trả lời chi tiết và 'suggestions' là một mảng chuỗi cho các gợi ý. Tình huống: ${userRisk}`;
                makeApiCall(prompt, aiResponseContainerRisk, loaderRisk, aiResponseRisk, suggestionContainerRisk, userRisk, shareRiskBtnContainer, riskBase64Data);
                if (aiResponseContainerRisk.contains(suggestionContainerRisk)) {
                    aiResponseContainerRisk.removeChild(suggestionContainerRisk);
                }
                 aiResponseContainerRisk.appendChild(suggestionContainerRisk);
            });

             adviceBtn.addEventListener('click', async () => {
                const userAdvice = adviceInput.value.trim();
                if (!userAdvice && !adviceBase64Data.data) {
                    alert('Vui lòng nhập câu hỏi hoặc tải lên một hình ảnh.');
                    return;
                }
                aiResponseAdvice.innerHTML = '';
                aiResponseContainerAdvice.classList.add('hidden');
                
                const prompt = `Hãy đóng vai trò là một kỹ sư M&E/HVAC có kinh nghiệm. Dựa trên câu hỏi/tình huống sau, đưa ra lời khuyên chuyên nghiệp và hữu ích. Sử dụng Markdown để định dạng câu trả lời với các tiêu đề, danh sách, và in đậm. Sau đó, hãy đưa ra 3 gợi ý câu hỏi tiếp theo có liên quan đến tình huống này. Trả lời bằng JSON với hai trường 'response' cho câu trả lời chi tiết và 'suggestions' là một mảng chuỗi cho các gợi ý. Tình huống: ${userAdvice}`;
                makeApiCall(prompt, aiResponseContainerAdvice, loaderAdvice, aiResponseAdvice, suggestionContainerAdvice, userAdvice, shareAdviceBtnContainer, adviceBase64Data);
                if (aiResponseContainerAdvice.contains(suggestionContainerAdvice)) {
                    aiResponseContainerAdvice.removeChild(suggestionContainerAdvice);
                }
                 aiResponseContainerAdvice.appendChild(suggestionContainerAdvice);
            });
            
            // UI Navigation
            const updateNavButtons = (pageIndex) => {
                const navButtons = [navBtn1, navBtn2, navBtn3];
                navButtons.forEach(btn => {
                    btn.classList.remove('bg-cyan-600', 'text-white');
                    btn.classList.add('bg-slate-200', 'text-slate-700');
                });
                navButtons[pageIndex].classList.add('bg-cyan-600', 'text-white');
                navButtons[pageIndex].classList.remove('bg-slate-200', 'text-slate-700');
            };
            
            navBtn1.addEventListener('click', () => {
                pageContainer.scrollTo({
                    left: page1.offsetLeft,
                    behavior: 'smooth'
                });
                updateNavButtons(0);
            });

            navBtn2.addEventListener('click', () => {
                pageContainer.scrollTo({
                    left: page2.offsetLeft,
                    behavior: 'smooth'
                });
                updateNavButtons(1);
            });

            navBtn3.addEventListener('click', () => {
                 pageContainer.scrollTo({
                    left: page3.offsetLeft,
                    behavior: 'smooth'
                });
                updateNavButtons(2);
            });

            pageContainer.addEventListener('scroll', () => {
                const scrollLeft = pageContainer.scrollLeft;
                const pageOffsets = [page1.offsetLeft, page2.offsetLeft, page3.offsetLeft];
                let currentPage = 0;
                if (scrollLeft > pageOffsets[1] - page1.offsetWidth / 2) {
                    currentPage = 1;
                }
                if (scrollLeft > pageOffsets[2] - page1.offsetWidth / 2) {
                    currentPage = 2;
                }
                updateNavButtons(currentPage);
            });

            updateNavButtons(0); // Set initial active button
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>

